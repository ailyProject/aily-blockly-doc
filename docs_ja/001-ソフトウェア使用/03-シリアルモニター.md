# シリアルモニター使用ガイド

シリアルモニターは、データの送受信、リアルタイムチャート表示、クイック送信など多くの機能をサポートする強力なシリアル通信デバッグツールです。

---

## 目次

- [基本設定](#基本設定)
  - [ポート選択](#ポート選択)
  - [ボーレート設定](#ボーレート設定)
  - [高度なシリアル設定](#高度なシリアル設定)
  - [接続/切断](#接続切断)
- [データ表示エリア](#データ表示エリア)
  - [表示モード設定](#表示モード設定)
  - [検索機能](#検索機能)
  - [データエクスポート](#データエクスポート)
  - [表示クリア](#表示クリア)
  - [折れ線グラフ機能](#折れ線グラフ機能)
- [データ送信エリア](#データ送信エリア)
  - [送信モード設定](#送信モード設定)
  - [クイック送信](#クイック送信)
  - [クイック送信エディター](#クイック送信エディター)
- [ショートカットキー](#ショートカットキー)
- [よくある質問](#よくある質問)

---

## 基本設定

### ポート選択

1. **ポート** ドロップダウンをクリック
2. リストからターゲットシリアルデバイスを選択
3. デバイスが接続されている場合、デバイス名が表示されます（`COM3`、`/dev/ttyUSB0` など）
4. システムは自動的に現在の開発ボードに一致するポートを識別してハイライト表示します

> **ヒント**: シリアルポートが1つだけ検出された場合、システムは自動的にそのポートを選択します。

### ボーレート設定

1. **ボーレート** ドロップダウンをクリック
2. 適切なボーレートを選択

**サポートされているボーレート**：

| 一般的なボーレート | 高速ボーレート |
|-----------|-----------|
| 4800      | 460800    |
| 9600      | 921600    |
| 19200     | 1000000   |
| 38400     | 2000000   |
| 57600     | 3000000   |
| 115200    | 4000000   |
| 230400    |           |

> **注意**: ボーレートはターゲットデバイスの設定と一致する必要があります。そうでないと文字化けが発生します。

### 高度なシリアル設定

設定バーの右側にある **歯車アイコン** (⚙️) をクリックして高度な設定パネルを展開します：

| パラメータ | オプション | デフォルト | 説明 |
|-----|--------|-------|------|
| **データビット** | 5, 6, 7, 8 | 8 | 1文字あたりのデータビット数 |
| **ストップビット** | 1, 1.5, 2 | 1 | ストップビット長 |
| **パリティ** | なし, 奇数, 偶数, マーク, スペース | なし | エラー検出方式 |
| **フロー制御** | なし, RTS/CTS, XON/XOFF | なし | データフロー制御方式 |

> **ヒント**: 高度な設定を変更した後、シリアルポートがすでに接続されている場合、システムは自動的に再接続して新しい設定を適用します。

### 接続/切断

- 設定バーの右側にある **スイッチボタン** を使用してシリアルポート接続を制御します
- **オン**：選択したシリアルポートに接続
- **オフ**：シリアルポートを切断

接続に成功すると、ウィンドウタイトルに現在のシリアルポートとボーレート情報が表示されます（例：`シリアルモニター（COM3 - 115200）`）

---

## データ表示エリア

データ表示エリアはインターフェースの中央にあり、受信および送信されたデータを表示するために使用されます。

### データタイプ識別

| 識別子 | 説明 |
|-----|------|
| **RX** | 受信データ |
| **TX** | 送信データ |
| **SYS** | システムメッセージ（接続状態、信号設定など） |

### 表示モード設定

データ表示エリアの右側には、以下の表示制御ボタンがあります：

| アイコン | 機能 | 説明 |
|-----|------|------|
| **Hex** | 16進数表示 | データを16進数形式で表示（例：`FF A1 B2`） |
| ↵ | 自動折り返し | 長いデータを自動的に折り返して表示 |
| ↓ | 自動スクロール | 新しいデータが到着したときに自動的に下部にスクロール |
| 🕐 | タイムスタンプ表示 | 各データの前に受信/送信時刻を表示 |
| 👁 | 制御文字表示 | 制御文字を可視シンボルとして表示（`\r\n`、`\t` など） |

### 検索機能

1. **虫眼鏡アイコン** (🔍) をクリックして検索ボックスを開きます
2. 検索したいキーワードを入力
3. 一致したコンテンツがハイライト表示されます
4. **前へ / 次へ** ボタンを使用して検索結果間を移動
5. 検索ボックスに現在の一致位置と総一致数が表示されます（例：`2/10`）

### データエクスポート

1. **ダウンロードアイコン** (⬇️) をクリックしてデータをエクスポート
2. 保存場所とファイル名を選択
3. データは `.txt` 形式で保存されます
4. エクスポートされたコンテンツは、現在の表示設定（タイムスタンプ、Hexモード、制御文字など）に基づいてフォーマットされます

**デフォルトファイル名形式**：`log_YYYY_MM_DD_HH_mm_ss.txt`

### 表示クリア

**ゴミ箱アイコン** (🗑️) をクリックしてすべての表示データをクリアします。

> **注意**: クリア後はデータを復元できません。クリアする前に重要なデータをエクスポートしてください。

### 折れ線グラフ機能

シリアルモニターはリアルタイムデータの可視化をサポートしています：

1. **折れ線グラフアイコン** (📈) をクリックしてチャートパネルを開きます
2. チャートは受信した数値データを自動的に解析します

**データ形式要件**：
```
value1,value2,value3,...\r\n
```

- 各行のデータは改行文字で終了
- 複数の値はカンマで区切る
- 各値は独立した折れ線チャンネルとして表示されます
- 最大10チャンネルをサポート、超過すると色が循環します

**チャートの特徴**：
- 時間軸の自動スケール
- リアルタイムスクロール表示
- 最大1000データポイントを保持
- ウィンドウサイズの調整をサポート

---

## データ送信エリア

データ送信エリアはインターフェースの下部にあり、上端をドラッグして高さを調整できます。

### 送信モード設定

送信エリアの右側には、以下のモード設定ボタンがあります：

| アイコン | 機能 | 説明 |
|-----|------|------|
| **Hex** | Hex送信モード | データを16進数形式で送信（例：`FF A1` を入力すると `0xFF 0xA1` バイトが送信されます） |
| ↵ | Enter送信 | 有効にすると `Enter` キーで直接送信、無効の場合は `Ctrl+Enter` で送信 |
| **R** | CR追加 | 送信時に自動的にキャリッジリターン文字 `\r` を追加 |
| **N** | LF追加 | 送信時に自動的にラインフィード文字 `\n` を追加 |

> **ヒント**: CRとLFの両方を有効にすると、送信データの末尾に `\r\n` が追加されます。これは最も一般的な行終端記号です。

### データ送信

1. 入力ボックスに送信するデータを入力
2. 必要に応じて送信モードを選択
3. **送信ボタン** (✈️) をクリックするか、ショートカットキーを使用して送信

### クイック送信

クイック送信バーは送信エリアの上部にあり、プリセットのクイック送信ボタンを表示します：

**デフォルトのクイック送信項目**：

| 名前 | タイプ | 機能 |
|-----|------|------|
| **DTR** | 信号 | DTR制御信号を送信 |
| **RTS** | 信号 | RTS制御信号を送信 |
| **テキスト送信** | テキスト | プリセットのテキストコンテンツを送信 |
| **Hex送信** | Hex | プリセットの16進数データを送信 |

クイック送信ボタンをクリックすると、対応するコンテンツがすぐに送信されます。

### クイック送信エディター

1. クイック送信バーの右側にある **編集ボタン** をクリックしてエディターを開きます
2. JSON形式でクイック送信リストを編集
3. **保存** をクリックして変更を適用

**JSON形式の例**：
```json
[
  { "name": "DTR", "type": "signal", "data": "DTR" },
  { "name": "RTS", "type": "signal", "data": "RTS" },
  { "name": "Hello", "type": "text", "data": "Hello World!" },
  { "name": "0xFF", "type": "hex", "data": "FF FF 00 01 02" }
]
```

**タイプの説明**：

| type | 説明 |
|------|------|
| `signal` | 制御信号（DTRまたはRTS） |
| `text` | プレーンテキスト、CR/LF設定に従って行終端記号を追加 |
| `hex` | 16進数データ、CR/LF設定を無視 |

---

## ショートカットキー

| ショートカット | 機能 | 条件 |
|-------|------|------|
| `Enter` | データ送信 | 「Enter送信」モード有効時 |
| `Ctrl + Enter` | データ送信 | 「Enter送信」モード無効時 |

---

## よくある質問

### Q: シリアルポートリストが空またはデバイスが見つからない？

**A**: 
- デバイスが正しく接続されているか確認
- USBドライバーがインストールされているか確認
- デバイスを再接続してみてください
- 一部のデバイスには専用ドライバーが必要です（CH340、CP2102など）

### Q: 受信データが文字化けしている？

**A**: 
- ボーレート設定がデバイスと一致しているか確認
- データビット、ストップビット、パリティ設定を確認
- Hexモードを使用して生データを表示してみてください

### Q: データを送信できない？

**A**: 
- シリアルポートが接続されているか確認（スイッチがオン）
- デバイスが正常に動作しているか確認
- フロー制御設定を確認

### Q: 折れ線グラフにデータが表示されない？

**A**: 
- 送信データの形式が正しいか確認（カンマ区切りの値、改行で終了）
- データに有効な数値が含まれているか確認
- チャートパネルが開いていることを確認

### Q: 設定が失われた？

**A**: 
- シリアルモニターは自動的に設定を保存します（ポート、ボーレート、高度な設定など）
- 設定はアプリケーションの設定ファイルに保存されます
- アプリケーションを再起動すると、前回の設定が自動的に復元されます

---

## データストレージの説明

シリアルモニターはインテリジェントなデータグループ化戦略を採用しています：

- 連続して受信されたデータはマージして保存され、エントリ数を削減
- 受信間隔が **1秒を超える** と、新しいデータエントリが作成されます
- 単一データの持続時間が **10秒を超える** と、新しいデータエントリが作成されます
- 送信データまたはシステムメッセージは直ちに独立したエントリを作成します

この設計は、データの完全性を確保しながら、ユーザーが通信記録を簡単に表示および分析できるようにします。

---

## バージョン情報

- サポートされているオペレーティングシステム：Windows、macOS、Linux
- ElectronとAngularで構築
- SerialPortライブラリを使用してシリアル通信を実装
